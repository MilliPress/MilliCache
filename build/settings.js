(()=>{"use strict";var e={n:i=>{var a=i&&i.__esModule?()=>i.default:()=>i;return e.d(a,{a}),a},d:(i,a)=>{for(var t in a)e.o(a,t)&&!e.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:a[t]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i)};const i=window.wp.domReady;var a=e.n(i);const t=window.wp.element,l=window.wp.i18n,s=window.wp.components,c=window.wp.primitives,n=window.ReactJSXRuntime,o=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),r=window.wp.apiFetch;var h=e.n(r);const d=window.wp.sanitize,m=(0,t.createContext)(),_=({children:e})=>{const[i,a]=(0,t.useState)([]),l=e=>{a((i=>i.filter((i=>i.id!==e))))};return(0,n.jsxs)(m.Provider,{value:{showSnackbar:(e,i=[],t=3e3,s=!1)=>{const c=Math.random().toString(36).slice(2,11);a((a=>[...a,{id:c,content:e,actions:i,explicitDismiss:s,spokenMessage:e}])),setTimeout((()=>{l(c)}),t)}},children:[e,(0,n.jsx)(s.SnackbarList,{className:"millicache-settings-snacks",notices:i,onRemove:e=>l(e)})]})},g=()=>(0,t.useContext)(m),x=(0,t.createContext)(),u=({children:e})=>{const[i,a]=(0,t.useState)({}),[s,c]=(0,t.useState)({}),[o,r]=(0,t.useState)({}),[m,_]=(0,t.useState)(!0),[u,p]=(0,t.useState)(!1),[j,v]=(0,t.useState)(null),[b,y]=(0,t.useState)(!1),[w,f]=(0,t.useState)(!1),[C,S]=(0,t.useState)("status"),[k,z]=(0,t.useState)(!1),P=(0,t.useRef)(null),{showSnackbar:M}=g(),A=e=>new Promise((i=>setTimeout(i,e))),N=(0,t.useCallback)((e=>{let i=(0,l.__)("An unexpected error occurred.","millicache");if(e?.message)i=e.message;else if(e?.code)switch(e.code){case"rest_no_route":i=(0,l.__)("API endpoint not found. Please check your WordPress installation.","millicache");break;case"rest_forbidden":i=(0,l.__)("Access denied. Please check your permissions.","millicache");break;case"rest_cookie_invalid_nonce":i=(0,l.__)("Security check failed. Please refresh the page.","millicache");break;default:i=e.message||(0,l.__)("API request failed.","millicache")}return"string"==typeof i?(0,d.stripTags)(i):i}),[]),F=(0,t.useCallback)((async e=>{try{return await A(300),await h()(e)}catch(e){const i=N(e);throw new Error(i)}}),[N]),T=(0,t.useCallback)((async()=>{try{const e=await F({path:"/millicache/v1/status",method:"GET"});return a(e),v(null),e}catch(e){const i=e.message;return a({connected:!1,error:i}),v(i),i}}),[F]),B=(0,t.useCallback)((async()=>{try{_(!0);const e=await F({path:"/wp/v2/settings"});c(e?.millicache),r(e?.millicache),v(null)}catch(e){const i=e.message;v(i)}finally{_(!1)}}),[F]),D=(0,t.useCallback)((async()=>{z(!0),v(null);try{await Promise.all([B(),T()])}catch(e){}finally{z(!1)}}),[B,T]);return(0,t.useEffect)((()=>(B(),T(),P.current&&clearInterval(P.current),P.current=setInterval((()=>{j||T()}),15e3),()=>{P.current&&clearInterval(P.current)})),[B,T,j]),(0,n.jsx)(x.Provider,{value:{status:i,settings:s,error:j,isLoading:m,isSaving:u,hasChanges:b,updateSetting:(e,i,a)=>{c((t=>{const l={...t,[e]:{...t[e],[i]:a}};return y(JSON.stringify(l)!==JSON.stringify(o)),"storage"===e&&f(!0),l}))},saveSettings:async()=>{if(b)try{if(p(!0),await F({path:"/wp/v2/settings",method:"POST",data:{millicache:s}}),r(s),M((0,l.__)("Settings saved successfully.","millicache")),y(!1),w){const e={...i};await A(500),M((0,l.__)("Storage settings updated. Testing connection…","millicache")),await A(3e3);const a=await T();a&&e&&(e.storage?.connected&&!a.storage?.connected?(await A(50),M((0,l.__)("Storage connection lost. Please check your settings.","millicache"))):!e.storage?.connected&&a.storage?.connected&&M((0,l.__)("Storage connection established successfully.","millicache")),a.storage?.error&&M(a.storage.error,[],6e3,!0)),f(!1)}}catch(e){const i=e.message||(0,l.__)("Failed to save settings.","millicache");M(i,[],6e3,!0)}finally{setTimeout((()=>p(!1)),1200)}},triggerAction:async(e,i={})=>{_(!0);try{const a=e.startsWith("clear")?"cache":"settings",t=await F({path:`/millicache/v1/${a}`,method:"POST",data:{action:e,...i}});if(await A(800),!t.success)throw new Error(t.message||(0,l.__)("Action failed","millicache"));M(t.message),B(),T()}catch(e){const i=e.message||(0,l.__)("Action failed","millicache");throw M(i,[],6e3,!0),e}finally{_(!1)}},activeTab:C,setActiveTab:S,retryConnection:D,isRetrying:k},children:e})},p=()=>(0,t.useContext)(x),j=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})}),v=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{fillRule:"evenodd",d:"M17.375 15.656A6.47 6.47 0 0018.5 12a6.47 6.47 0 00-.943-3.374l-1.262.813c.448.749.705 1.625.705 2.561a4.977 4.977 0 01-.887 2.844l1.262.813zm-1.951 1.87l-.813-1.261A4.976 4.976 0 0112 17c-.958 0-1.852-.27-2.613-.736l-.812 1.261A6.47 6.47 0 0012 18.5a6.47 6.47 0 003.424-.974zm-8.8-1.87A6.47 6.47 0 015.5 12c0-1.235.344-2.39.943-3.373l1.261.812A4.977 4.977 0 007 12c0 1.056.328 2.036.887 2.843l-1.262.813zm2.581-7.803A4.977 4.977 0 0112 7c1.035 0 1.996.314 2.794.853l.812-1.262A6.47 6.47 0 0012 5.5a6.47 6.47 0 00-3.607 1.092l.812 1.261zM12 20a8 8 0 100-16 8 8 0 000 16zm0-4.5a3.5 3.5 0 100-7 3.5 3.5 0 000 7z",clipRule:"evenodd"})}),b=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{d:"M2 11.2v1.5h20v-1.5H2zM5.5 6c0-.3.2-.5.5-.5h12c.3 0 .5.2.5.5v3H20V6c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v3h1.5V6zm2 14h2v-1.5h-2V20zm3.5 0h2v-1.5h-2V20zm7-1.5V20c1.1 0 2-.9 2-2h-1.5c0 .3-.2.5-.5.5zm.5-2H20V15h-1.5v1.5zM5.5 18H4c0 1.1.9 2 2 2v-1.5c-.3 0-.5-.2-.5-.5zm0-3H4v1.5h1.5V15zm9 5h2v-1.5h-2V20z"})}),y=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{d:"M5.5 12h1.75l-2.5 3-2.5-3H4a8 8 0 113.134 6.35l.907-1.194A6.5 6.5 0 105.5 12zm9.53 1.97l-2.28-2.28V8.5a.75.75 0 00-1.5 0V12a.747.747 0 00.218.529l1.282-.84-1.28.842 2.5 2.5a.75.75 0 101.06-1.061z"})}),w=({isModalOpen:e,onRequestClose:i})=>{const{triggerAction:a}=p(),{showSnackbar:c}=g(),[o,r]=(0,t.useState)([]),h=()=>{i(),r([])};return e&&(0,n.jsx)(s.Modal,{title:(0,l.__)("Clear Cache","millicache"),onRequestClose:h,focusOnMount:"firstContentElement",children:(0,n.jsxs)(s.Flex,{direction:"column",children:[(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)("p",{children:(0,l.__)("Enter one or more Cache Flags, Post-IDs or URLs for which you want to clear the cache. You can use wildcards (*) to clear multiple related flags.","millicache")})}),(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)(s.FormTokenField,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,l.__)("Targets to clear (Optional)","millicache"),value:o,onChange:r,suggestions:[]})}),(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)(s.Button,{isPrimary:!0,onClick:async()=>{try{await a("clear_targets",{targets:o}),h()}catch(e){c((0,l.__)("Error clearing cache.","millicache"))}},children:0===o.length?(0,l.__)("Clear Website Cache","millicache"):(0,l.__)("Clear Cache of Targets","millicache")})})]})})},f=()=>{const{status:e,saveSettings:i,isSaving:a,isLoading:c,hasChanges:o,triggerAction:r}=p(),[h,d]=(0,t.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.PanelBody,{children:(0,n.jsxs)(s.Flex,{align:"center",children:[(0,n.jsxs)(s.FlexItem,{children:[(0,n.jsx)("h1",{style:{padding:"0"},children:(0,l.__)("MilliCache","millicache")}),(0,n.jsxs)(s.Flex,{expanded:"false",justify:"start",children:[(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)(s.ExternalLink,{className:"external-link",href:"https://github.com/MilliPress/MilliCache/blob/main/README.md",children:(0,l.__)("Documentation","millicache")})}),(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)(s.ExternalLink,{className:"external-link",href:"https://github.com/MilliPress/MilliCache/issues",children:(0,l.__)("Support","millicache")})})]})]}),(0,n.jsxs)(s.FlexItem,{align:"end",children:[(0,n.jsx)(s.Button,{__next40pxDefaultSize:!0,style:{marginRight:"10px"},isBusy:a,isPrimary:!0,onClick:i,disabled:!o||a,children:a?(0,l.__)("Saving…","millicache"):(0,l.__)("Save Settings","millicache")}),(0,n.jsx)(s.Button,{__next40pxDefaultSize:!0,label:(0,l.__)("Clear Cache","millicache"),showTooltip:!0,variant:"secondary",onClick:()=>{d(!0)},disabled:a||c||!e.storage?.connected||e.cache?.index<1,children:(0,l.__)("Clear Cache","millicache")}),(0,n.jsx)(s.Dropdown,{className:"millicache-actions-dropdown",contentClassName:"millicache-actions-dropdown-content",popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:e,onToggle:i})=>(0,n.jsx)(s.Button,{__next40pxDefaultSize:!0,icon:j,label:(0,l.__)("Cache Actions","millicache"),disabled:a||c,onClick:i,"aria-expanded":e}),renderContent:i=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(s.MenuGroup,{label:(0,l.__)("More Actions","millicache"),children:[(0,n.jsx)(s.MenuItem,{__next40pxDefaultSize:!0,icon:v,iconPosition:"left",onClick:()=>{i.onClose(),window.open("https://github.com/MilliPress/MilliCache/issues","_blank")},children:(0,l.__)("Get Help","millicache")}),(0,n.jsx)(s.MenuItem,{__next40pxDefaultSize:!0,icon:b,iconPosition:"left",onClick:()=>{i.onClose(),r("reset")},disabled:e.settings?.has_defaults,children:(0,l.__)("Reset all Settings","millicache")}),e.settings?.has_backup&&e.settings?.has_defaults&&(0,n.jsx)(s.MenuItem,{__next40pxDefaultSize:!0,icon:y,iconPosition:"left",onClick:()=>{i.onClose(),r("restore")},children:(0,l.__)("Restore previous Settings","millicache")})]})})}),(0,n.jsx)(w,{isModalOpen:h,onRequestClose:()=>{d(!1)}})]})]})}),c||a&&(0,n.jsx)(s.Animate,{type:"slide-in",options:{origin:"top center"},children:({className:e})=>(0,n.jsx)(s.ProgressBar,{className:`millicache-settings-progress ${e}`})})]})},C=()=>{var e,i,a,t,c,o,r,h,d,m;const{error:_,status:g,isLoading:x}=p(),u={[(0,l.__)("Status","millicache")]:g.storage?.connected?(0,l.__)("Connected","millicache"):(0,l.__)("Disconnected","millicache"),[(0,l.__)("Host","millicache")]:null!==(e=g.storage?.config.host)&&void 0!==e?e:"N/A",[(0,l.__)("Port","millicache")]:null!==(i=g.storage?.config.port)&&void 0!==i?i:"N/A",[(0,l.__)("Database","millicache")]:null!==(a=g.storage?.config.database)&&void 0!==a?a:"N/A"},j={[(0,l.__)("Cache Index","millicache")]:null!==(t=g.cache?.index)&&void 0!==t?t:"N/A",[(0,l.__)("Cache Size","millicache")]:null!==(c=g.cache?.size_human)&&void 0!==c?c:"N/A",[(0,l.__)("Drop-in Status","millicache")]:Array.isArray(g.dropin)&&0===g.dropin.length?(0,l.__)("Missing","millicache"):g.dropin?.outdated?(0,l.__)("Outdated","millicache"):(0,l.__)("Up to date","millicache"),[(0,l.__)("Drop-in Type","millicache")]:Array.isArray(g.dropin)&&0===g.dropin.length?(0,l.__)("Missing","millicache"):("symlink"===g.dropin?.type?(0,l.__)("Symlinked","millicache"):(0,l.__)("Copied","millicache"))+(g.dropin?.custom?" & "+(0,l.__)("Customized","millicache"):"")},v={[(0,l.__)("Version","millicache")]:null!==(o=g.storage?.info?.Server?.version)&&void 0!==o?o:"N/A",[(0,l.__)("Databases Available","millicache")]:null!==(r=g.storage?.config?.databases)&&void 0!==r?r:"N/A",[(0,l.__)("Used Memory","millicache")]:null!==(h=g.storage?.info?.Memory?.used_memory_human)&&void 0!==h?h:"N/A",[(0,l.__)("Max Memory","millicache")]:null!==(d=g.storage?.info?.Memory?.maxmemory_human)&&void 0!==d?d:"N/A",[(0,l.__)("Max Memory Policy","millicache")]:null!==(m=g.storage?.info?.Memory?.maxmemory_policy)&&void 0!==m?m:"N/A"};return(0,n.jsxs)(s.PanelBody,{children:[x&&(0,n.jsx)(s.Spinner,{}),_&&(0,n.jsx)(s.Notice,{status:"error",children:_}),g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{children:(0,l.__)("Connection","millicache")}),(0,n.jsx)("table",{className:"widefat striped fixed",cellSpacing:"0",children:(0,n.jsx)("tbody",{children:Object.entries(u).map((([e,i])=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("strong",{children:[e,":"]})}),(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:i})})]},e)))})}),(0,n.jsx)("h2",{children:(0,l.__)("Cache","millicache")}),(0,n.jsx)("table",{className:"widefat striped fixed",cellSpacing:"0",children:(0,n.jsx)("tbody",{children:Object.entries(j).map((([e,i])=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("strong",{children:[e,":"]})}),(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:i})})]},e)))})}),(0,n.jsx)("h2",{children:(0,l.__)("Storage Server","millicache")}),(0,n.jsx)("table",{className:"widefat striped fixed",cellSpacing:"0",children:(0,n.jsx)("tbody",{children:Object.entries(v).map((([e,i])=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("strong",{children:[e,":"]})}),(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:i})})]},e)))})})]})]})},S=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{d:"M10.5 4v4h3V4H15v4h1.5a1 1 0 011 1v4l-3 4v2a1 1 0 01-1 1h-3a1 1 0 01-1-1v-2l-3-4V9a1 1 0 011-1H9V4h1.5zm.5 12.5v2h2v-2l3-4v-3H8v3l3 4z"})}),k=(0,n.jsx)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",children:(0,n.jsx)(c.Path,{d:"M19.53 4.47a.75.75 0 0 1 0 1.06L17.06 8l.77.769a3.155 3.155 0 0 1 .685 3.439 3.15 3.15 0 0 1-.685 1.022v.001L13.23 17.83v.001a3.15 3.15 0 0 1-4.462 0L8 17.06l-2.47 2.47a.75.75 0 0 1-1.06-1.06L6.94 16l-.77-.769a3.154 3.154 0 0 1-.685-3.439 3.15 3.15 0 0 1 .685-1.023l4.599-4.598a3.152 3.152 0 0 1 4.462 0l.769.768 2.47-2.47a.75.75 0 0 1 1.06 0Zm-2.76 7.7L15 13.94 10.06 9l1.771-1.77a1.65 1.65 0 0 1 2.338 0L16.77 9.83a1.649 1.649 0 0 1 0 2.338h-.001ZM13.94 15 9 10.06l-1.77 1.771a1.65 1.65 0 0 0 0 2.338l2.601 2.602a1.649 1.649 0 0 0 2.338 0v-.001L13.94 15Z"})}),z=(0,t.forwardRef)((({icon:e,size:i=24,...a},l)=>(0,t.cloneElement)(e,{width:i,height:i,...a,ref:l}))),P=(0,n.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(c.Path,{d:"M12 4a8 8 0 1 1 .001 16.001A8 8 0 0 1 12 4Zm0 1.5a6.5 6.5 0 1 0-.001 13.001A6.5 6.5 0 0 0 12 5.5Zm.75 11h-1.5V15h1.5v1.5Zm-.445-9.234a3 3 0 0 1 .445 5.89V14h-1.5v-1.25c0-.57.452-.958.917-1.01A1.5 1.5 0 0 0 12 8.75a1.5 1.5 0 0 0-1.5 1.5H9a3 3 0 0 1 3.305-2.984Z"})}),M=({label:e,tooltip:i,iconSize:a=16,justify:t="flex-start",style:l={},tooltipProps:c={},iconProps:o={}})=>(0,n.jsxs)(s.Flex,{align:"center",gap:1,style:l,justify:t,children:[(0,n.jsx)("span",{children:e}),(0,n.jsx)(s.Tooltip,{text:i,delay:"250",style:{maxWidth:"300px"},...c,children:(0,n.jsx)("span",{className:"millicache-tooltip-icon",style:{display:"flex",alignItems:"center"},children:(0,n.jsx)(z,{icon:P,size:a,...o})})})]}),A=()=>{var e,i,a,t,c,o,r,h;const{status:d,settings:m,updateSetting:_}=p();return(0,n.jsxs)(s.Panel,{children:[(0,n.jsx)(s.PanelBody,{children:(0,n.jsx)(s.PanelRow,{children:(0,l.__)("Configure the general settings for the cache.","millicache")})}),(0,n.jsx)(s.PanelBody,{title:(0,l.__)("Storage Server","millicache"),className:"storage-settings-"+(d?.storage?.connected?"connected":"disconnected"),icon:d?.storage?.connected?k:S,initialOpen:!d?.storage?.connected,children:(0,n.jsxs)(s.Flex,{direction:"column",gap:"4",children:[(0,n.jsxs)(s.Flex,{justify:"start",children:[(0,n.jsx)(s.FlexItem,{isBlock:"true",children:(0,n.jsx)(s.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Server Host","millicache"),tooltip:(0,l.__)('The hostname or IP address of your Redis, Valkey, KeyDB, or other compatible server. Typically "localhost" or "127.0.0.1" for local servers.',"millicache")}),value:null!==(e=m.storage.host)&&void 0!==e?e:d.storage?.config.host,disabled:!("host"in m.storage),onChange:e=>_("storage","host",e)})}),(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)(s.__experimentalNumberControl,{__next40pxDefaultSize:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Server Port","millicache"),tooltip:(0,l.__)("The port your storage server listens on. Default is 6379 for most installations.","millicache")}),style:{width:"120px"},value:null!==(i=m.storage.port)&&void 0!==i?i:d.storage?.config.port,disabled:!("port"in m.storage),min:"1024",max:"65535",onChange:e=>_("storage","port",e)})})]}),(0,n.jsxs)(s.Flex,{justify:"start",children:[(0,n.jsx)(s.FlexItem,{isBlock:"true",children:(0,n.jsx)(s.__experimentalInputControl,{__next40pxDefaultSize:!0,type:"password",label:(0,n.jsx)(M,{label:(0,l.__)("Authentication Password","millicache"),tooltip:(0,l.__)("Password used to authenticate with your Redis, Valkey, or other compatible server. Leave empty if your server does not require authentication.","millicache")}),value:null!==(a=m.storage.enc_password)&&void 0!==a?a:"",disabled:!("enc_password"in m.storage),onChange:e=>_("storage","enc_password",e)})}),(0,n.jsx)(s.FlexItem,{children:(0,n.jsx)(s.__experimentalNumberControl,{__next40pxDefaultSize:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Database ID","millicache"),tooltip:(0,l.__)("The database to use within your storage server (typically 0-15, with 0 being the default).","millicache")}),style:{width:"120px"},value:null!==(t=m.storage.db)&&void 0!==t?t:d.storage?.config.database,disabled:!("db"in m.storage),max:null!==(c=d?.storage?.config.databases-1)&&void 0!==c?c:15,min:"0",onChange:e=>_("storage","db",e)})})]}),(0,n.jsx)(s.FlexItem,{style:{flexGrow:0},children:(0,n.jsx)(s.ToggleControl,{__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Persistent Storage Connection","millicache"),tooltip:(0,l.__)("When enabled, maintains a persistent connection to the server instead of creating a new connection for each request. Improves performance but uses more server resources.","millicache")}),checked:null!==(o=m.storage.persistent)&&void 0!==o?o:d.storage?.config.persistent,disabled:!("persistent"in m.storage),onChange:e=>_("storage","persistent",e)})})]})}),(0,n.jsx)(s.PanelBody,{title:(0,l.__)("Cache Settings","millicache"),initialOpen:d?.storage?.connected,children:(0,n.jsxs)(s.Flex,{direction:"column",gap:"4",children:[(0,n.jsxs)(s.Flex,{justify:"start",align:"start",children:[(0,n.jsx)(s.FlexItem,{isBlock:"true",children:(0,n.jsx)(s.__experimentalUnitControl,{__next40pxDefaultSize:!0,label:(0,n.jsx)(M,{label:(0,l.__)("TTL (Cache Expiry)","millicache"),tooltip:(0,l.__)("Time To Live - How long cache is considered fresh before becoming stale. Fresh cache is served directly without regeneration.","millicache")}),disabled:!("ttl"in m.cache),value:(e=>{const i=null!==(e=m.cache.ttl)&&void 0!==e?e:d.cache?.ttl;let a,t;return i%86400==0?(a=i/86400,t="d"):i%3600==0?(a=i/3600,t="h"):i%60==0?(a=i/60,t="m"):(a=i,t="s"),`${a}${t}`})(),onChange:e=>{const i=parseFloat(e);let a=i;switch(e.replace(i,"")){case"m":a=60*i;break;case"h":a=3600*i;break;case"d":a=86400*i;break;default:a=i}_("cache","ttl",a)},min:"1",units:[{value:"s",label:(0,l.__)("Seconds","millicache"),default:3e3},{value:"m",label:(0,l.__)("Minutes","millicache"),default:120},{value:"h",label:(0,l.__)("Hours","millicache"),default:24},{value:"d",label:(0,l.__)("Days","millicache"),default:7}]})}),(0,n.jsx)(s.FlexItem,{isBlock:"true",children:(0,n.jsx)(s.__experimentalUnitControl,{__next40pxDefaultSize:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Grace Period","millicache"),tooltip:(0,l.__)("Time after TTL expiration when stale cache can still be served while new content is generated in the background. Helps reduce user wait times. 0 = disable.","millicache")}),disabled:!("grace"in m.cache),value:(e=>{const i=null!==(e=m.cache.grace)&&void 0!==e?e:d.cache?.grace;let a,t;return i%2592e3==0?(a=i/2592e3,t="m"):i%604800==0?(a=i/604800,t="w"):i%86400==0?(a=i/86400,t="d"):i%3600==0?(a=i/3600,t="h"):i%60==0?(a=i/60,t="m"):(a=i,t="s"),`${a}${t}`})(),onChange:e=>{const i=parseFloat(e);let a=i;switch(e.replace(i,"")){case"h":a=3600*i;break;case"d":a=86400*i;break;case"w":a=604800*i;break;case"m":a=2592e3*i;break;default:a=i}_("cache","grace",a)},units:[{value:"h",label:(0,l.__)("Hours","millicache"),default:12},{value:"d",label:(0,l.__)("Days","millicache"),default:7},{value:"w",label:(0,l.__)("Weeks","millicache"),default:4},{value:"m",label:(0,l.__)("Months","millicache"),default:1}]})})]}),(0,n.jsx)(s.ToggleControl,{__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Enable Gzip Compression","millicache"),tooltip:(0,l.__)("Compresses cached data to reduce storage space usage. Slightly increases CPU usage but significantly reduces memory consumption.","millicache")}),checked:null!==(r=m.cache.gzip)&&void 0!==r?r:d.cache?.gzip,disabled:!("gzip"in m.cache),onChange:e=>_("cache","gzip",e)}),(0,n.jsx)(s.ToggleControl,{__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Enable Debugging","millicache"),tooltip:(0,l.__)("Adds detailed debug information to response headers such as the cache flags and times.","millicache")}),checked:null!==(h=m.cache.debug)&&void 0!==h?h:d.cache?.debug,disabled:!("debug"in m.cache),onChange:e=>_("cache","debug",e)}),(0,n.jsx)(s.FormTokenField,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("No-Cache Paths","millicache"),tooltip:(0,l.__)('URL paths that are not cached. You can use * wildcards (e.g. "/shop/*") or regular expressions, which must be enclosed in / characters (e.g. "/^/products/[0-9]+$/").')}),placeholder:(0,l.__)('Add path or pattern (e.g. "/shop/", "/blog/*", "/^/products/[0-9]+$/")',"millicache"),value:m.cache.nocache_paths?m.cache.nocache_paths:d.cache?.nocache_paths,disabled:!("nocache_paths"in m.cache),onChange:e=>_("cache","nocache_paths",e),suggestions:[]}),(0,n.jsx)(s.FormTokenField,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("No-Cache Cookies","millicache"),tooltip:(0,l.__)('Cookies that prevent caching. Example: "session_*" will skip caching if a cookie starting with "session_" is set. * = wildcard.')}),placeholder:(0,l.__)('Add cookie name or pattern (e.g. "session_*")',"millicache"),value:m.cache.nocache_cookies?m.cache.nocache_cookies:d.cache?.nocache_cookies,disabled:!("nocache_cookies"in m.cache),onChange:e=>_("cache","nocache_cookies",e),suggestions:[]}),(0,n.jsx)(s.FormTokenField,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Ignored Cookies","millicache"),tooltip:(0,l.__)('Cookies that are ignored when creating cache keys. Example: "dark_mode" means all users share the same cache regardless of the preference. * = wildcard.')}),placeholder:(0,l.__)('Add cookie name or pattern (e.g. "dark_mode")',"millicache"),value:m.cache.ignore_cookies?m.cache.ignore_cookies:d.cache?.ignore_cookies,disabled:!("ignore_cookies"in m.cache),onChange:e=>_("cache","ignore_cookies",e),suggestions:[]}),(0,n.jsx)(s.FormTokenField,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.jsx)(M,{label:(0,l.__)("Ignored Request Keys","millicache"),tooltip:(0,l.__)('URL parameters that are ignored when creating cache keys. Example: "utm_*" means analytics parameters such as "utm_source" are ignored when creating cache keys. * = wildcard.')}),value:m.cache.ignore_request_keys?m.cache.ignore_request_keys:d.cache?.ignore_request_keys,placeholder:(0,l.__)('Add parameter name or pattern (e.g. "utm_*")',"millicache"),disabled:!("ignore_request_keys"in m.cache),onChange:e=>_("cache","ignore_request_keys",e),suggestions:[]})]})})]})},N=()=>{const{error:e,isLoading:i,activeTab:a,setActiveTab:t,retryConnection:c,isRetrying:r}=p(),h=({error:e,onRetry:i,isRetrying:a})=>(0,n.jsxs)("div",{className:"millicache-error-container",style:{padding:"60px 20px",textAlign:"center",maxWidth:"600px",margin:"0 auto"},children:[(0,n.jsx)("div",{style:{marginBottom:"24px"},children:(0,n.jsx)(s.Icon,{icon:o,size:48,style:{color:"#dc3232",opacity:.8}})}),(0,n.jsx)("h2",{style:{margin:"0 0 16px 0",fontSize:"24px",fontWeight:"600",color:"#1e1e1e"},children:(0,l.__)("Connection Error","millicache")}),(0,n.jsx)("p",{style:{fontSize:"16px",lineHeight:"1.5",color:"#646970",maxWidth:"500px",margin:"0 auto 32px auto"},children:e}),(0,n.jsx)("div",{style:{marginBottom:"32px",display:"flex",justifyContent:"center",gap:"12px",flexWrap:"wrap"},children:(0,n.jsx)(s.Button,{variant:"primary",onClick:i,isBusy:a,disabled:a,children:a?(0,l.__)("Retrying...","millicache"):(0,l.__)("Try Again","millicache")})}),(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#646970",lineHeight:"1.6"},children:[(0,n.jsx)("p",{style:{margin:"0"},children:(0,l.__)("Need help fixing this issue?","millicache")}),(0,n.jsx)(s.Button,{href:"https://www.millipress.com/docs/millicache/troubleshooting",target:"_blank",variant:"tertiary",size:"compact",style:{margin:"0"},children:(0,l.__)("View Troubleshooting Guide","millicache")+" →"})]})]});return(0,n.jsx)("div",{style:{maxWidth:"900px"},children:(0,n.jsxs)(s.Panel,{children:[(0,n.jsx)(f,{}),i?(0,n.jsx)(s.Animate,{type:"slide-in",options:{origin:"top center"},children:({className:e})=>(0,n.jsxs)("div",{className:"millicache-loading-container",children:[(0,n.jsx)(s.ProgressBar,{className:`millicache-settings-progress ${e}`}),(0,n.jsx)("p",{style:{textAlign:"center",margin:"10px 0"},children:(0,l.__)("Loading MilliCache settings...","millicache")})]})}):e?(0,n.jsx)(h,{error:e,onRetry:c,isRetrying:r}):(0,n.jsx)(s.Animate,{type:"slide-in",options:{origin:"top"},children:({className:e})=>(0,n.jsx)(s.TabPanel,{className:`millicache-settings-tabs ${e}`,style:{border:"1px solid #ddd",marginLeft:"-1px",marginRight:"-1px"},initialTabName:a,onSelect:e=>{t(e)},tabs:[{name:"status",title:(0,l.__)("Status","millicache")},{name:"settings",title:(0,l.__)("Settings","millicache")}],children:e=>(0,n.jsx)("div",{className:"millicache-settings-tab-content",style:{margin:"-1px"},children:(0,n.jsxs)("div",{children:["status"===e.name&&(0,n.jsx)(C,{}),"settings"===e.name&&(0,n.jsx)(A,{})]})})})})]})})};a()((()=>{(0,t.createRoot)(document.getElementById("millicache-settings")).render((0,n.jsx)(_,{children:(0,n.jsx)(u,{children:(0,n.jsx)(N,{})})}))}))})();